From 2c7d7e28a3b8aa28cfe4c577fff1793685f94f8b Mon Sep 17 00:00:00 2001
From: darkyzhou <me@zqy.io>
Date: Sun, 27 Jul 2025 11:47:25 +0800
Subject: [PATCH 3/3] hadrian: Enable GHCi on all platforms

This removes the platform-specific restrictions for GHCi support,
allowing it to be built on all target OS and architecture combinations.

Originally implemented for Debian packaging to ensure GHCi availability
across all supported platforms.

Co-authored-by: Ilias Tsitsimpis <iliastsi@debian.org>
---
 hadrian/bindist/config.mk.in   | 4 ++--
 hadrian/src/Oracles/Setting.hs | 9 ++-------
 2 files changed, 4 insertions(+), 9 deletions(-)

diff --git a/hadrian/bindist/config.mk.in b/hadrian/bindist/config.mk.in
index e82a37e5..17bec1c2 100644
--- a/hadrian/bindist/config.mk.in
+++ b/hadrian/bindist/config.mk.in
@@ -140,8 +140,8 @@ GhcWithSMP := $(strip $(if $(filter YESNO, $(ArchSupportsSMP)$(GhcUnregisterised
 
 # Whether to include GHCi in the compiler.  Depends on whether the RTS linker
 # has support for this OS/ARCH combination.
-OsSupportsGHCi=$(strip $(patsubst $(TargetOS_CPP), YES, $(findstring $(TargetOS_CPP), mingw32 linux solaris2 freebsd dragonfly netbsd openbsd darwin kfreebsdgnu)))
-ArchSupportsGHCi=$(strip $(patsubst $(TargetArch_CPP), YES, $(findstring $(TargetArch_CPP), i386 x86_64 powerpc powerpc64 powerpc64le sparc sparc64 arm aarch64)))
+OsSupportsGHCi=YES
+ArchSupportsGHCi=YES
 
 ifeq "$(OsSupportsGHCi)$(ArchSupportsGHCi)" "YESYES"
 GhcWithInterpreter=YES
diff --git a/hadrian/src/Oracles/Setting.hs b/hadrian/src/Oracles/Setting.hs
index a0f639d3..4613663f 100644
--- a/hadrian/src/Oracles/Setting.hs
+++ b/hadrian/src/Oracles/Setting.hs
@@ -302,13 +302,8 @@ hostSupportsRPaths = anyHostOs (elfOSes ++ machoOSes)
 -- | Check whether the target supports GHCi.
 ghcWithInterpreter :: Action Bool
 ghcWithInterpreter = do
-    goodOs <- anyTargetOs [ "mingw32", "cygwin32", "linux", "solaris2"
-                          , "freebsd", "dragonfly", "netbsd", "openbsd"
-                          , "darwin", "kfreebsdgnu" ]
-    goodArch <- anyTargetArch [ "i386", "x86_64", "powerpc"
-                              , "arm", "aarch64", "s390x"
-                              , "powerpc64", "powerpc64le" ]
-    return $ goodOs && goodArch
+    -- Enable GHCi on all platforms for Debian
+    return True
 
 -- | Variants of the ARM architecture.
 data ArmVersion = ARMv5 | ARMv6 | ARMv7
-- 
2.49.0

